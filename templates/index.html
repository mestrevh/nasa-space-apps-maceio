<!doctype html>
<html>
<head>
    <title>Análise de Documentos com Neo4j</title>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { font-family: system-ui, sans-serif; margin: 0; display: flex; height: 100vh; background-color: #f4f4f9; }
        .sidebar { width: 350px; padding: 20px; background-color: #fff; border-right: 1px solid #ddd; box-shadow: 2px 0 5px rgba(0,0,0,0.1); overflow-y: auto; }
        .main-content { flex-grow: 1; }
        #mynetwork { width: 100%; height: 100%; }
        h1, h2 { color: #333; }
        form { margin-top: 20px; }
        input[type="file"] { border: 1px solid #ccc; padding: 8px; border-radius: 4px; width: 100%; }
        button { background-color: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; width: 100%; margin-top: 10px; font-size: 16px; }
        button:hover { background-color: #0056b3; }
        #status { margin-top: 15px; padding: 10px; border-radius: 4px; background-color: #e9ecef; color: #495057; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h1>Análise de PDF</h1>
        <p>Envie um documento PDF para extrair entidades e relações, e visualizá-las no grafo.</p>
        
        <form id="upload-form">
            <input type="file" id="pdf-input" name="pdf_file" accept=".pdf" required>
            <button type="submit">Processar PDF</button>
        </form>

        <div id="status">Pronto para receber um arquivo.</div>
    </div>

    <div class="main-content">
        <div id="mynetwork"></div>
    </div>

<script type="text/javascript">
    const container = document.getElementById('mynetwork');
    const statusDiv = document.getElementById('status');
    const uploadForm = document.getElementById('upload-form');
    const pdfInput = document.getElementById('pdf-input');
    let network = null;

    // 1. Função para desenhar ou atualizar o grafo
    function desenharGrafo(graphData) {
        const data = {
            nodes: new vis.DataSet(graphData.nodes),
            edges: new vis.DataSet(graphData.edges)
        };
        const options = { /* ... opções do Vis.js ... */ };
        network = new vis.Network(container, data, options);
    }

    // 2. Função para buscar os dados do grafo na API e desenhar
    function atualizarGrafo() {
        statusDiv.textContent = 'Atualizando visualização do grafo...';
        fetch('/api/data')
            .then(response => response.json())
            .then(data => {
                desenharGrafo(data);
                statusDiv.textContent = 'Grafo atualizado.';
            })
            .catch(error => {
                console.error('Erro ao buscar dados do grafo:', error);
                statusDiv.textContent = 'Erro ao atualizar o grafo.';
            });
    }

    // 3. Lógica para o formulário de upload
    uploadForm.addEventListener('submit', function(event) {
        event.preventDefault(); // Impede o envio tradicional do formulário
        
        const formData = new FormData();
        formData.append('pdf_file', pdfInput.files[0]);

        statusDiv.textContent = 'Enviando arquivo...';

        fetch('/upload', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(result => {
            if (result.error) {
                throw new Error(result.error);
            }
            console.log('Sucesso:', result);
            statusDiv.innerHTML = `<b>${result.message}</b><br>
                                   Entidades: ${result.entidades_encontradas}<br>
                                   Relações: ${result.relacoes_encontradas}`;
            // Após o sucesso, atualiza a visualização do grafo
            atualizarGrafo();
        })
        .catch(error => {
            console.error('Erro:', error);
            statusDiv.textContent = `Erro no processamento: ${error.message}`;
        });
    });

    // 4. Carrega o grafo inicial quando a página abre
    document.addEventListener('DOMContentLoaded', atualizarGrafo);
</script>

</body>
</html>